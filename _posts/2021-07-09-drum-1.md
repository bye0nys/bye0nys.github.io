---
title: "_야, 너도 드럼 칠 수 있어_ : 1. 드럼 비트 샘플 파일 입력"

categories:
   - projects

tags:
   - projects
   - python
   - FFT

comments: true
toc: true
toc_sticky: true

date: 2021-07-09 16:43 +0900
last_modified_at: 2021-07-09 18:46 +0900
---

# 드럼 악보 채보 프로젝트

* 본 글은 제 대학교 3학년 여름 방학이었던 2019년 6월부터 3개월 간 진행했던, __"야, 너도 드럼 칠 수 있어"__ 프로젝트에 관련된 설명 글입니다.
* 편의상 설명 과정은 _'~했다.'_ 로 작성하였습니다.
* __소스 코드__ 는 다음과 같습니다. [__(Source)__](https://github.com/bye0nys/drum-final)

> 채보의 사전적 정의 : 음악을 듣고 악보로 옮겨 적는 것

<br/>

# 0. 사용 라이브러리

<div class="colorscripter-code" style="color:#010101;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; position:relative !important;overflow:auto"><table class="colorscripter-code-table" style="margin:0;padding:0;border:none;background-color:#fafafa;border-radius:4px;" cellspacing="0" cellpadding="0"><tr><td style="padding:6px;border-right:2px solid #e5e5e5"><div style="margin:0;padding:0;word-break:normal;text-align:right;color:#666;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="line-height:130%">1</div><div style="line-height:130%">2</div><div style="line-height:130%">3</div><div style="line-height:130%">4</div><div style="line-height:130%">5</div><div style="line-height:130%">6</div><div style="line-height:130%">7</div><div style="line-height:130%">8</div></div></td><td style="padding:6px 0;text-align:left"><div style="margin:0;padding:0;color:#010101;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#a71d5d">import</span>&nbsp;numpy&nbsp;<span style="color:#a71d5d">as</span>&nbsp;np</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#a71d5d">import</span>&nbsp;matplotlib.pyplot&nbsp;<span style="color:#a71d5d">as</span>&nbsp;plt</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#a71d5d">import</span>&nbsp;scipy.io.wavfile&nbsp;<span style="color:#a71d5d">as</span>&nbsp;wav</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#a71d5d">import</span>&nbsp;wave</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#a71d5d">import</span>&nbsp;glob</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#a71d5d">import</span>&nbsp;os.path</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#a71d5d">import</span>&nbsp;cv2</div><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#a71d5d">import</span>&nbsp;sounddevice&nbsp;<span style="color:#a71d5d">as</span>&nbsp;sd</div></div></td><td style="vertical-align:bottom;padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="text-decoration:none;color:white"><span style="font-size:9px;word-break:normal;background-color:#e5e5e5;color:white;border-radius:10px;padding:1px">cs</span></a></td></tr></table></div><br/>

주요 라이브러리와 사용된 이유는 아래와 같다.

1. __numpy__ : 배열을 생성, 편집할 수 있는 라이브러리. FFT 함수가 내장되어 있고, 이를 활용하기 위해 사용.
2. __matplotlib__ : 여러 그래프를 plot하기 위한 라이브러리. 개발 중 여러 실험들을 진행하며, 눈으로 결과를 확인하기 위해 사용.
3. __scipy, wave__ : scipy는 여러 과학적 계산과정이 포함된 라이브러리이며, wave와 함께 .wav 파일을 분석하기 위해 사용.
4. __glob, os.path, cv2__ : 모두 파일 입,출력을 구현하기 위해 사용.
5. __sounddevice__ : 결과 시연 과정에서 파일을 재생하는 과정에 사용.<br/><br/>

# 1. 파일 입력

- 먼저, ".wav"파일을 불러오기 위해 다음과 같이 추가했다.<br/>

<div class="colorscripter-code" style="color:#010101;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; position:relative !important;overflow:auto"><table class="colorscripter-code-table" style="margin:0;padding:0;border:none;background-color:#fafafa;border-radius:4px;" cellspacing="0" cellpadding="0"><tr><td style="padding:6px;border-right:2px solid #e5e5e5"><div style="margin:0;padding:0;word-break:normal;text-align:right;color:#666;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="line-height:130%">1</div><div style="line-height:130%">2</div></div></td><td style="padding:6px 0;text-align:left"><div style="margin:0;padding:0;color:#010101;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%">myPath&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#63a35c">'PATH'</span></div><div style="padding:0 6px; white-space:pre; line-height:130%">myExt&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#63a35c">'*.wav'</span></div></div></td><td style="vertical-align:bottom;padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="text-decoration:none;color:white"><span style="font-size:9px;word-break:normal;background-color:#e5e5e5;color:white;border-radius:10px;padding:1px">cs</span></a></td></tr></table></div>

> PATH에 주소를 지정하고, ".wav"확장자를 불러온다.

- 이후, (후에 사용될) 이미지 파일을 불러왔다.

<div class="colorscripter-code" style="color:#010101;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; position:relative !important;overflow:auto"><table class="colorscripter-code-table" style="margin:0;padding:0;border:none;background-color:#fafafa;border-radius:4px;" cellspacing="0" cellpadding="0"><tr><td style="padding:6px;border-right:2px solid #e5e5e5"><div style="margin:0;padding:0;word-break:normal;text-align:right;color:#666;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="line-height:130%">1</div></div></td><td style="padding:6px 0;text-align:left"><div style="margin:0;padding:0;color:#010101;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%">default&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;cv2.imread(<span style="color:#63a35c">"C:/drum/default.png"</span>,cv2.IMREAD_REDUCED_COLOR_4)</div></div></td><td style="vertical-align:bottom;padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="text-decoration:none;color:white"><span style="font-size:9px;word-break:normal;background-color:#e5e5e5;color:white;border-radius:10px;padding:1px">cs</span></a></td></tr></table></div>

> 드럼을 연주할 때, 한 번에 최대로 연주될 수 있는 요소는 셋 이라고 판단했다.<br/>(양손에 채 하나, 킥 드럼 하나)

- 그렇게 총 32가지의 이미지를 준비했다.<br/><br/>

# 2. 음원의 샘플링레이트, 진폭 계산

- 이후, 입력된 파일들을 분석했다.

<div class="colorscripter-code" style="color:#010101;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; position:relative !important;overflow:auto"><table class="colorscripter-code-table" style="margin:0;padding:0;border:none;background-color:#fafafa;border-radius:4px;" cellspacing="0" cellpadding="0"><tr><td style="padding:6px;border-right:2px solid #e5e5e5"><div style="margin:0;padding:0;word-break:normal;text-align:right;color:#666;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="line-height:130%">1</div><div style="line-height:130%">2</div><div style="line-height:130%">3</div><div style="line-height:130%">4</div><div style="line-height:130%">5</div><div style="line-height:130%">6</div><div style="line-height:130%">7</div><div style="line-height:130%">8</div><div style="line-height:130%">9</div><div style="line-height:130%">10</div></div></td><td style="padding:6px 0;text-align:left"><div style="margin:0;padding:0;color:#010101;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%"><span style="color:#a71d5d">for</span>&nbsp;filename&nbsp;<span style="color:#a71d5d">in</span>&nbsp;glob.glob(os.path.join(myPath,&nbsp;myExt)):</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;rate,&nbsp;data0&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;wav.read(filename)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;data1&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.full(np.alen(data0),&nbsp;<span style="color:#0099cc">0</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;data2&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.full(np.alen(data0),&nbsp;<span style="color:#0099cc">0</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;data1&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.array(data0)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;times&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;np.arange(<span style="color:#066de2">len</span>(data0))&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">/</span>&nbsp;float(rate)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;original&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;wave.<span style="color:#066de2">open</span>(filename,&nbsp;<span style="color:#63a35c">'rb'</span>)</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;nChannel&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;original.getnchannels()</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;length&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;original.getnframes()</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;original.<span style="color:#066de2">close</span>()</div></div><div style="text-align:right;margin-top:-13px;margin-right:5px;font-size:9px;font-style:italic"><a href="http://colorscripter.com/info#e" target="_blank" style="color:#e5e5e5text-decoration:none">Colored by Color Scripter</a></div></td><td style="vertical-align:bottom;padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="text-decoration:none;color:white"><span style="font-size:9px;word-break:normal;background-color:#e5e5e5;color:white;border-radius:10px;padding:1px">cs</span></a></td></tr></table></div>

> glob과 os.path를 활용해 입력, 출력 부분을 설정했다.<br/>
> data* 이름으로 변수를 설정했다.<br/>
> 총 프레임을 시간으로 나누어 Sampling-rate를 구했고, 
> wave를 활용해 파일의 채널과 총 길이를 구했다.<br/>

- Stereo 일 경우 wave 라이브러리로 처리하기 어려워, Stereo가 입력되면 Left 채널만 사용했다.<br/>
  
<div class="colorscripter-code" style="color:#010101;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important; position:relative !important;overflow:auto"><table class="colorscripter-code-table" style="margin:0;padding:0;border:none;background-color:#fafafa;border-radius:4px;" cellspacing="0" cellpadding="0"><tr><td style="padding:6px;border-right:2px solid #e5e5e5"><div style="margin:0;padding:0;word-break:normal;text-align:right;color:#666;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="line-height:130%">1</div><div style="line-height:130%">2</div><div style="line-height:130%">3</div></div></td><td style="padding:6px 0;text-align:left"><div style="margin:0;padding:0;color:#010101;font-family:Consolas, 'Liberation Mono', Menlo, Courier, monospace !important;line-height:130%"><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;<span style="color:#a71d5d">if</span>&nbsp;nChannel&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span><span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;<span style="color:#0099cc">2</span>:</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data2&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;data0[:,&nbsp;<span style="color:#0099cc">0</span>]</div><div style="padding:0 6px; white-space:pre; line-height:130%">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data1&nbsp;<span style="color:#0086b3"></span><span style="color:#a71d5d">=</span>&nbsp;data2</div></div></td><td style="vertical-align:bottom;padding:0 2px 4px 0"><a href="http://colorscripter.com/info#e" target="_blank" style="text-decoration:none;color:white"><span style="font-size:9px;word-break:normal;background-color:#e5e5e5;color:white;border-radius:10px;padding:1px">cs</span></a></td></tr></table></div>

> data0[:, 0] 을 통해 Left 채널만 활용했다.